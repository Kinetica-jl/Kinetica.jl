<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ASE Calculator Builders · Kinetica.jl</title><meta name="title" content="ASE Calculator Builders · Kinetica.jl"/><meta property="og:title" content="ASE Calculator Builders · Kinetica.jl"/><meta property="twitter:title" content="ASE Calculator Builders · Kinetica.jl"/><meta name="description" content="Documentation for the Kinetica.jl package and its modular kinetic calculators."/><meta property="og:description" content="Documentation for the Kinetica.jl package and its modular kinetic calculators."/><meta property="twitter:description" content="Documentation for the Kinetica.jl package and its modular kinetic calculators."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Kinetica.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Kinetica.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting-started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/arbitrary-conditions/">Arbitrary Simulation Conditions</a></li><li><a class="tocitem" href="../../tutorials/ode-solution/">ODE Solution</a></li><li><a class="tocitem" href="../../tutorials/kinetic-calculators/">Kinetic Calculators</a></li><li><a class="tocitem" href="../../tutorials/iterative-exploration/">Iterative CRN Exploration</a></li><li><a class="tocitem" href="../../tutorials/results-analysis/">Results Analysis</a></li><li><a class="tocitem" href="../../tutorials/filtering-crns/">Filtering CRNs</a></li><li><a class="tocitem" href="../../tutorials/saving-loading/">Saving &amp; Loading</a></li><li><a class="tocitem" href="../../tutorials/logging/">Logging</a></li></ul></li><li><span class="tocitem">Developing with Kinetica</span><ul><li><a class="tocitem" href="../crn-representation/">CRN Representation</a></li><li><a class="tocitem" href="../condition-profiles/">Condition Profiles</a></li><li><a class="tocitem" href="../calculator-interface/">Calculator Interface</a></li><li class="is-active"><a class="tocitem" href>ASE Calculator Builders</a></li><li><a class="tocitem" href="../implementation-details/">Implementation Details</a></li></ul></li><li><span class="tocitem">API</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Kinetica.jl</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/kinetica/exploration/">Exploration</a></li><li><a class="tocitem" href="../../api/kinetica/solving/">Solving</a></li><li><a class="tocitem" href="../../api/kinetica/conditions/">Conditions</a></li><li><a class="tocitem" href="../../api/kinetica/analysis/">Analysis</a></li><li><a class="tocitem" href="../../api/kinetica/openbabel/">Open Babel</a></li><li><a class="tocitem" href="../../api/kinetica/rdkit/">RDKit</a></li><li><a class="tocitem" href="../../api/kinetica/utilities/">Utilities</a></li><li><input class="collapse-toggle" id="menuitem-5-1-8" type="checkbox"/><label class="tocitem" for="menuitem-5-1-8"><span class="docs-label">ASE Interface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/kinetica/ase_calculator/calculator/">Kinetic Calculator</a></li><li><a class="tocitem" href="../../api/kinetica/ase_calculator/optimisation/">Optimisation</a></li><li><a class="tocitem" href="../../api/kinetica/ase_calculator/builders/">Builders</a></li><li><a class="tocitem" href="../../api/kinetica/ase_calculator/utilities/">Utilities</a></li></ul></li><li><a class="tocitem" href="../../api/kinetica/autode/">autodE Interface</a></li></ul></li><li><a class="tocitem" href="../../api/kineticakpm/">KineticaKPM.jl</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developing with Kinetica</a></li><li class="is-active"><a href>ASE Calculator Builders</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ASE Calculator Builders</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Kinetica-jl/Kinetica.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Creating-ASE-Calculator-Builders"><a class="docs-heading-anchor" href="#Creating-ASE-Calculator-Builders">Creating ASE Calculator Builders</a><a id="Creating-ASE-Calculator-Builders-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-ASE-Calculator-Builders" title="Permalink"></a></h1><p>One of the key parts of the <a href="../../api/kinetica/ase_calculator/calculator/#Kinetica.ASENEBCalculator"><code>ASENEBCalculator</code></a> kinetic calculator is the idea of an energy/force calculator <em>builder</em>. These are Julia functors that instantiate the Python <code>Calculator</code> classes responsible for determining the energy of a given atomic system in ASE. These builders are required because it is often necessary to construct multiple ASE <code>Calculator</code>s for different <code>Atoms</code> objects, but there is no simple way to do this automatically within Kinetica&#39;s calculation workflows. Builders therefore abstract this construction away from the user, presenting a handful of parameters with sensible defaults for a given calculator.</p><p>Kinetica.jl comes with three builders, but they&#39;re very easy to implement - not only for <code>Calculator</code>s that exist within ASE, but for others that come from external packages and themselves have interfaces to ASE. For example, while ASE doesn&#39;t internally support any MLIPs for energy and force evaluation, many MLIPs come with Python frontends that can hook into ASE. Kinetica can take advantage of these frontends to also hook such MLIPs into its rate calculation workflow.</p><p>As an example, this tutorial will implement a calculator builder for <a href="https://arxiv.org/abs/2207.09971">NeuralNEB</a>, a modern MLIP based on the PaiNN architecture. NeuralNEB&#39;s <a href="https://gitlab.com/matschreiner/neuralneb">Python frontend</a> comes with an ASE calculator under <code>neuralneb.utils.MLCalculator</code>, which requires a PaiNN model (which can be constructed through <code>neuralneb.painn.PaiNN</code>) that has been loaded with trained parameters as input.</p><p>At their core, most calculator builders have 3 components:</p><ul><li>A struct containing parameters.</li><li>An outer constructor providing a way of loading Python objects into the struct once at its construction. This is not technically necessary, but speeds up the creation of ASE energy/force calculators on-the-fly since it avoids excessive reimporting of Python modules.</li><li>A functor method with arguments <code>(dir::String, mult::Int, chg::Int, kwargs...)</code>, where <code>dir</code> is the directory a given calculation should take place in, <code>mult</code> is the spin multiplicity of a supplied atomic system, <code>chg</code> is its charge and <code>kwargs</code> are keyword arguments to pass to the ASE calculator class upon instantiation. Some or all of these arguments may not be used depending on the calculator, but Kinetica will always provide them.</li></ul><p>For our exemplary NeuralNEB calculator, its struct could look something like this (note that PythonCall needs to be accessible):</p><pre><code class="language-julia hljs">mutable struct NeuralNEBBuilder
    calc_class::Py
    painn_class::Py
    device::String
    statedict
end</code></pre><p>Here, <code>calc_class</code> will hold the uninstantiated ASE calculator class, <code>painn_class</code> will do the same for the uninstantiated PaiNN class, <code>device</code> will be the PyTorch device to run the calculations on (CPU or GPU) and <code>statedict</code> will hold the parameters for the trained model. Rather than users having to pass this all manually and import these classes themselves though, we can implement an outer constructor:</p><pre><code class="language-julia hljs">function NeuralNEBBuilder(modelpath::String, device::String)
    torch = pyimport(&quot;torch&quot;)
    nn_utils = pyimport(&quot;neuralneb.utils&quot;)
    nn_painn = pyimport(&quot;neuralneb.painn&quot;)
    statedict = torch.load(modelpath)
    return NeuralNEBBuilder(nn_utils.MLCalculator, nn_painn.PaiNN, device, statedict)
end</code></pre><p>Now all that users of our builder need to supply are the path to the model parameters (<code>modelpath</code>) and the device. The constructor does the heavy lifting of setting up the Python side of things.</p><p>Finally, this struct needs a method that can be called to instantiate the <code>calc_class</code>, such that it can be provided as a calculator directly to ASE:</p><pre><code class="language-julia hljs">function (builder::NeuralNEBBuilder)(dir::String, mult::Int, chg::Int, kwargs...)
    model = builder.painn_class(3, 256, 5)
    model.load_state_dict(builder.statedict)
    model.eval()
    return builder.calc_class(model, device=builder.device)
end</code></pre><p>This functor creates a fresh PaiNN model from the parameters in the struct, sets it to evaluation mode and instantiates the <code>MLCalculator</code> class on the requested device. Notably, none of the arguments of this functor are actually used. This is fine, as NeuralNEB doesn&#39;t write any files, and doesn&#39;t take any external multiplicity or charge information. Many other calculators will do so however, so these arguments are provided as a catch-all to ensure that all builders have the information required to correctly instantiate their calculators.</p><p>After that, the builder is complete! It can now be used like any other energy/force calculator currently in Kinetica by constructing the builder and passing it to the <a href="../../api/kinetica/ase_calculator/calculator/#Kinetica.ASENEBCalculator"><code>ASENEBCalculator</code></a>:</p><pre><code class="language-julia hljs">builder = NeuralNEBBuilder(model=&quot;/path/to/model.sd&quot;, device=&quot;cuda&quot;)
calc = ASENEBCalculator(builder, &quot;./calc&quot;)

# solvemethod = VariableODESolve(pars, conditions, calc)
# res = solve_network(...)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../calculator-interface/">« Calculator Interface</a><a class="docs-footer-nextpage" href="../implementation-details/">Implementation Details »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Tuesday 27 May 2025 13:19">Tuesday 27 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
